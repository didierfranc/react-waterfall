{"version":3,"file":"react-waterfall.dev.js","sources":["../src/Components/Provider.js","../src/Components/Prevent.js","../src/helpers/connect.js","../src/helpers/subscriptions.js","../src/helpers/devtools.js","../src/index.js"],"sourcesContent":["// @flow\n/* eslint-disable no-undef */\n\nimport React from 'react'\n\nimport type { CreateProvider, State } from '../types'\n\ntype Props = { children: React$Node, initialState: {} }\n\nconst EnhancedProvider: CreateProvider = (\n  setProvider,\n  Provider,\n  initialState,\n) =>\n  class EnhancedProvider extends React.Component<Props, State> {\n    constructor(props) {\n      super(props)\n      this.state = props.initialState || initialState\n      setProvider(this)\n    }\n\n    render() {\n      return <Provider value={this.state}>{this.props.children}</Provider>\n    }\n  }\n\nexport default EnhancedProvider\n","// @flow\n/* eslint-disable no-undef */\n\nimport { PureComponent } from 'react'\n\ntype Props = {\n  renderComponent: ({}) => React$Node,\n}\n\nexport default class Prevent extends PureComponent<Props> {\n  render() {\n    const { renderComponent, ...rest } = this.props\n    return renderComponent(rest)\n  }\n}\n","// @flow\n/* eslint-disable no-undef */\n\nimport * as React from 'react'\nimport Prevent from '../Components/Prevent'\n\nimport type { CreateConnect } from '../types'\n\nconst connect: CreateConnect = Consumer => mapStateToProps => WrappedComponent => {\n  const renderComponent = props => <WrappedComponent {...props} />\n  const ConnectedComponent = props => (\n    <Consumer>\n      {state => {\n        const filteredState = mapStateToProps(state || {}, props)\n        return (\n          <Prevent\n            renderComponent={renderComponent}\n            {...props}\n            {...filteredState}\n          />\n        )\n      }}\n    </Consumer>\n  )\n\n  ConnectedComponent.displayName = `Connect(${WrappedComponent.displayName ||\n    WrappedComponent.name ||\n    'Unknown'})`\n  if (WrappedComponent.getInitialProps) {\n    ConnectedComponent.getInitialProps = WrappedComponent.getInitialProps\n  }\n\n  return ConnectedComponent\n}\n\nexport default connect\n","// @flow\n/* eslint-disable no-undef */\n\nimport type { Subscription } from '../types'\n\nexport default class Subscriptions {\n  subscriptions = []\n\n  getSubscriptions = () => this.subscriptions\n\n  subscribe = (subscription: Subscription) => {\n    this.subscriptions = [...this.subscriptions, subscription]\n  }\n\n  unsubscribe = (subscription: Subscription) => {\n    this.subscriptions = this.subscriptions.filter(subscriber => subscriber !== subscription)\n  }\n}\n","let id = 0\n\nexport default ({ initialState }, self) => {\n  const reduxDevTools = window.__REDUX_DEVTOOLS_EXTENSION__\n\n  const instanceID = id\n  id += 1\n\n  const name = `react-waterfall - ${instanceID}`\n  const features = {\n    jump: true,\n  }\n\n  const devTools = reduxDevTools.connect({ name, features })\n\n  devTools.subscribe(data => {\n    switch (data.type) {\n      case 'START':\n        devTools.init(initialState)\n        break\n      case 'RESET':\n        self.setState(initialState)\n        break\n      case 'DISPATCH':\n        switch (data.payload.type) {\n          case 'JUMP_TO_STATE':\n          case 'JUMP_TO_ACTION': {\n            self.setState(JSON.parse(data.state))\n            break\n          }\n          default:\n            break\n        }\n        break\n      default:\n        break\n    }\n  })\n\n  return (action, ...arg) => {\n    devTools.send({ type: action, ...arg }, self.state, {}, instanceID)\n  }\n}\n","// @flow\n/* eslint-disable no-undef */\n\nimport { createContext } from 'react'\n\nimport createProvider from './Components/Provider'\nimport createConnect from './helpers/connect'\nimport Subscriptions from './helpers/subscriptions'\nimport devtools from './helpers/devtools'\n\nimport type {\n  CreateStore,\n  ProviderType,\n  SetProvider,\n  CustomSetState,\n  Context,\n  State,\n} from './types'\n\nconst defaultMiddlewares =\n  process.env.NODE_ENV === 'development' &&\n  typeof window !== 'undefined' &&\n  window.devToolsExtension\n    ? [devtools]\n    : []\n\nconst createStore: CreateStore = (\n  { initialState, actionsCreators = {} },\n  middlewares = [],\n) => {\n  let provider: ProviderType\n  const context: Context = createContext()\n\n  const { getSubscriptions, subscribe, unsubscribe } = new Subscriptions()\n\n  const setProvider: SetProvider = self => {\n    const initializedMiddlewares = [...middlewares, ...defaultMiddlewares].map(middleware =>\n      middleware({ initialState, actionsCreators }, self, actions))\n\n    provider = {\n      setState: (state, callback) => self.setState(state, callback),\n      initializedMiddlewares,\n    }\n  }\n\n  let state = initialState\n\n  const setState: CustomSetState = (action, result, ...args) => {\n    if (typeof result === 'undefined') {\n      return Promise.resolve()\n    }\n    state = { ...state, ...result }\n    return new Promise(resolve => {\n      const subscriptions = getSubscriptions()\n      subscriptions.forEach(fn => fn(action, result, ...args))\n      provider.setState(state, () => {\n        provider.initializedMiddlewares.forEach(m => m(action, ...args))\n        resolve()\n      })\n    })\n  }\n\n  const actions = Object.keys(actionsCreators).reduce(\n    (r, v) => ({\n      ...r,\n      [v]: (...args) => {\n        if (!provider) {\n          console.error('<Provider /> is not initialized yet')\n          return\n        }\n\n        const result = actionsCreators[v](state, actions, ...args)\n\n        return (typeof result === 'object' && result.then)\n          ? result.then(result => setState(v, result, ...args))\n          : setState(v, result, ...args)\n      },\n    }),\n    {},\n  )\n\n  const Provider = createProvider(setProvider, context.Provider, initialState)\n  const connect = createConnect(context.Consumer)\n  const getState: State = () => state\n\n  return {\n    Provider,\n    connect,\n    actions,\n    subscribe,\n    unsubscribe,\n    getState,\n  }\n}\n\nexport default createStore\n"],"names":["EnhancedProvider","setProvider","Provider","initialState","props","state","React","Component","value","this","children","Prevent","PureComponent","renderComponent","connect","Consumer","mapStateToProps","WrappedComponent","React.createElement","ConnectedComponent","filteredState","displayName","name","getInitialProps","Subscriptions","_this","subscriptions","subscription","filter","subscriber","id","self","reduxDevTools","window","__REDUX_DEVTOOLS_EXTENSION__","instanceID","devTools","features","jump","subscribe","data","type","init","setState","payload","JSON","parse","action","arg","send","defaultMiddlewares","devToolsExtension","devtools","createStore","provider","actionsCreators","middlewares","context","createContext","getSubscriptions","unsubscribe","result","args","Promise","resolve","forEach","fn","initializedMiddlewares","m","actions","Object","keys","reduce","r","v","_typeof","then","console","error","createProvider","map","middleware","callback","createConnect","getState"],"mappings":"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"}